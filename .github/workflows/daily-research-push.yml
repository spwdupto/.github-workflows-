name: Daily Research Digest Push

on:
  schedule:
    # 每天 UTC 1:00 (北京时间 9:00)
    - cron: '0 1 * * *'
  workflow_dispatch:  # 手动触发调试

jobs:
  push-digest:
    runs-on: ubuntu-latest
    steps:
    - name: Trigger Dify Workflow
      env:
        DIFY_API_URL: ${{ secrets.DIFY_API_URL }}
        DIFY_API_KEY: ${{ secrets.DIFY_API_KEY }}
      run: |
       - name: Trigger Dify Workflow
        env:
          DIFY_API_KEY: ${{ secrets.DIFY_API_KEY }}
          DIFY_API_URL: ${{ secrets.DIFY_API_URL }} 
        run: |
          curl -X POST "$DIFY_API_URL" \
          -H "Authorization: Bearer $DIFY_API_KEY" \
          -H "Content-Type: application/json" \
          -d '{
                "inputs": {}, 
                "response_mode": "blocking",
                "user": "github-action-bot"
              }'
        
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | sed '$d')
        
        echo "HTTP Status: $http_code"
        echo "Response body: $body"
        
        if [ "$http_code" = "200" ]; then
          echo "✅ Daily push completed successfully"
        else
          echo "❌ Push failed with status $http_code"
          exit 1
        fi
